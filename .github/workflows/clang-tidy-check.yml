name: clang-tidy Check

on:
  push:
    branches:
    - main
    - dev
  pull_request:

jobs:
  clang-tidy:
    name: Lint with clang-tidy
    runs-on: ubuntu-latest

    steps:
    - uses: actions/checkout@v4

    - name: Install dependencies
      run: sudo apt-get update && sudo apt-get install -y clang-tidy cmake build-essential libsfml-dev

    - name: Configure CMake
      run: cmake -B build -DCMAKE_EXPORT_COMPILE_COMMANDS=ON -DCMAKE_BUILD_TYPE=Debug

    - name: Run clang-tidy
      run: |
        FILES=$(find libs/engine libs/network server client tests -type f \( -name "*.hpp" -o -name "*.cpp" \) 2>/dev/null || true)

        if [ -z "$FILES" ]; then
          echo "No files to analyze"
          exit 0
        fi

        for file in $FILES; do
          echo "Analyzing $file..."
          clang-tidy "$file" -p build --quiet --warnings-as-errors='' || true
        done
