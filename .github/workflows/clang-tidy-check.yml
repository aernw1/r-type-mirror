name: clang-tidy Check

on:
  push:
    branches:
    - main
    - dev
  pull_request:

jobs:
  clang-tidy:
    name: Lint with clang-tidy
    runs-on: ubuntu-latest

    steps:
    - uses: actions/checkout@v4

    - name: Install dependencies
      run: |
        sudo apt-get update
        sudo apt-get install -y clang-tidy

    - name: Run clang-tidy
      run: |
        echo "Analyse statique du code avec clang-tidy..."

        FILES=$(find include src -type f \( -name "*.hpp" -o -name "*.cpp" \) 2>/dev/null || true)

        if [ -z "$FILES" ]; then
          echo "Aucun fichier à analyser"
          exit 0
        fi

        EXIT_CODE=0
        for file in $FILES; do
          echo "Analyse de $file..."
          if ! clang-tidy "$file" -- -std=c++20 -Iinclude; then
            EXIT_CODE=1
          fi
        done

        if [ $EXIT_CODE -eq 0 ]; then
          echo "Aucun problème détecté !"
        else
          echo "Des problèmes ont été détectés. Consultez les logs ci-dessus."
        fi

        exit $EXIT_CODE
